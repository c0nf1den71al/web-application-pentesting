# Server-Side Template Injection
#Injection #Server-Side

Server-side template injection is when an attacker is able to use **template syntax** to inject a **malicious** payload into a **template**, which is then executed **server-side**.

An example of a static **twig** template can be seen below: 
```php
$output = $twig->render("Dear {first_name},", array("first_name" => $user.first_name) );
```

This is **not** vulnerable to server-side template injection because the user's first name is merely **passed** into the template as **data**. However, a vulnerable template may look like the following:
```php
`$output = $twig->render("Dear " . $_GET['name']);`
```

Part of the template is being **dynamically** generated using the `GET` parameter `name`. As template syntax is evaluated **server-side**, this potentially allows an attacker to place a server-side template injection **payload** inside the `name` **parameter**. 

## Detected Server-Side Template Injection
### Plaintext Context
Take the following code, for example:
```php
render('Hello ' + username)
```

Using the following URL `http://vulnerable-website.com/?username=${7*7}` would result in `Hello 49` being outputted. This indicates that this **is vulnerable**.

### Code Context
In other cases, user input might be placed within a template expression:
```php
greeting = getQueryParameter('greeting')
engine.render("Hello {{"+greeting+"}}", data)
```

`http://vulnerable-website.com/?greeting=data.username}}<tag>`. Sometimes XSS vulnerabilities can arise from server-side template injection and therefore, its useful to test. The `}}` can be used to escape from the template.

