# Access Control Vulnerabilities
#Access-Control #Bruteforce #HTTP-Headers 

Broken access controls are a commonly encountered and often **critical** security vulnerability. Design and management of access controls is a complex and dynamic problem that applies **business**, **organizational**, and **legal** constraints to a technical implementation.

## Types Of Access Control
### Vertical Access Controls
Vertical access controls are used to **restrict** access to sensitive functionality that is not available to **other types** of users. For example, an administrator might be able to **delete** a users account whist regular users cannot do this.

### Horizontal Access Controls
Horizontal access controls are mechanisms that restrict access to **resources** to the users who are **specifically** allowed to access those resources. An example of this might include a user who can view their **own** account details but not the details of **other** users.

### Context-Dependent Access Controls
Context-dependent access controls restrict access to **functionality** and **resources** based on the state of the application or the users interaction with it. For example, a user can't modify the **contents** of their shopping cart **after** they have made a payment.

## Exploiting Broken Access Controls
### Vertical Privilege Escalation
If a user can gain access to functionality that they are not **permitted** to access then this is vertical privilege escalation. For example, if a **non-administrative** user can in fact gain access to an **admin** page where they can delete user accounts, then this is [vertical](Access%20Control%20Vulnerabilities.md#Vertical%20Access%20Controls) privilege escalation.

#### Unprotected Functionality
The most basic [vertical](Access%20Control%20Vulnerabilities.md#Vertical%20Access%20Controls) privilege escalation is when an application does not enforce **any** protection over sensitive functionality. An example of when this might occur is when a user can access the `http://insecure-website.com/admin` endpoint directly without authentication.

Admin panels can often be disclosed within the `robots.txt` file, however, in some cases **less predictable** URLs are used. Whilst this might not be guessable, URLs are often revealed in **source code**.

#### Parameter-Based Access Control
Some applications determine the user's role or privilege using a **parameter**. This could include a **hidden field**, **cookie** or within the URL (e.g. a `GET` parameter).

This approach is **insecure** because a user can simply **modify** the value and gain access to function to which they are **not** authorised.

#### Platform Misconfiguration
Some application frameworks support **non-standard** HTTP headers that can be used to override the URL in the original request such as `X-Original-URL` and `X-Rewrite-URL`. If it is possible to **override** the original URL it might be possible to **bypass** the access controls using a request like the following:
```Request
POST / HTTP/1.1
X-Original-URL: /admin/deleteUser
...
```

### Horizontal Privilege Escalation
[Horizontal](Access%20Control%20Vulnerabilities.md#Horizontal%20Access%20Controls) privilege escalation arises when a user is able to gain access to **resources** belonging to **another** user.

#### Exploitable Request Parameters
Often the user's ID might be **exposed** in a request parameter, such as `https://insecure-website/account?id=12`. If the user ID is **incremental** you may be able to access other user accounts simply by altering the account ID. 

Often the user's ID might be a **randomly** generated string. In this case it might be possible to **brute-force** the user's ID or perhaps they are **disclosed** else where on the site.

#### Horizontal To Vertical Privilege Escalation
Often, a [horizontal](Access%20Control%20Vulnerabilities.md#Horizontal%20Access%20Controls) privilege escalation attack can be turned into a [vertical](Access%20Control%20Vulnerabilities.md#Vertical%20Access%20Controls) privilege escalation, by **compromising** a more privileged user. For example, a [horizontal](Access%20Control%20Vulnerabilities.md#Horizontal%20Access%20Controls) escalation might allow an attacker to **reset** or **capture** the password belonging to another user. If the attacker targets an **administrative** user, then they can gain administrative access and so perform [vertical](Access%20Control%20Vulnerabilities.md#Vertical%20Access%20Controls) privilege escalation. 

#### Insecure Direct Object References (IDOR)
IDOR arises when an application uses **user-supplied** input to access objects directly and an attacker can **modify** the input to obtain **unauthorized** access.

An example of this could be when a website stores a chat **transcript** as a **static** file, `https://insecure-website.com/static/12144.txt` and attacker can then **alter** the filename and read any transcript.

### Multi-Step Access Controls
Some websites might implement functions over **multiple** steps. This is often done using a variety of **inputs** or **options**, or when the user needs to review and confirm details before the action is **performed**.

Often steps are **secure**. However, in some cases, if the **last step** is **not secure** then the attacker can just send a request to this endpoint with their own details.

### Referer-Based Access Controls
Sites may base access controls on the `Referer` header submitted in the **HTTP** request. This header is generally **added** to requests by **browsers** to indicate the page from which the request was **initiated**.

For example, suppose an application robustly enforces access control over the main **administrative** page at `/admin`, but for sub-pages such as `/admin/deleteUser` only inspects the `Referer` header. If the `Referer` header contains the main `/admin` URL, then the request is **allowed**.

### Location-Based Access Controls
Some websites enforce access controls over resources based on the user's **geographical** location. This can apply, for example, to banking applications or media services where state **legislation** or business **restrictions** apply. These access controls can often be circumvented by the use of **web proxies**, **VPNs**, or manipulation of client-side geolocation mechanisms.