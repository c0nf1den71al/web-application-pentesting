# Clickjacking
#Clickjacking #CSP #CSRF #DOM #HTTP-Headers #XSS 

Clickjacking is an **interface-based** attack in which a user is tricked into clicking on actionable content on a hidden website by clicking on some other content in a **decoy website**.

The technique depends upon the incorporation of an **invisible**, **actionable** web page (or multiple pages) containing a **button** or **hidden link**, say, within an **iframe**. The iframe is overlaid on top of the user's anticipated decoy web page content. This attack differs from a [cross-site request forgery (CSRF)](Cross-Site%20Request%20Forgery%20(CSRF).md) attack in that the user is required to perform an action such as a button click whereas a [cross-site request forgery (CSRF)](Cross-Site%20Request%20Forgery%20(CSRF).md) attack depends upon **forging** an entire request without the user's knowledge or input.

## Constructing A Clickjacking Attack
Clickjacking attacks use **CSS** to create and manipulate layers. The attacker incorporates the target website as an **iframe** layer overlaid on the decoy website. An example can be seen below:
```html
<head>
	<style>
		#target_website {
			position:relative;
			width:128px;
			height:128px;
			opacity:0.00001;
			z-index:2;
			}
		#decoy_website {
			position:absolute;
			width:300px;
			height:400px;
			z-index:1;
			}
	</style>
</head>
...
<body>
	<div id="decoy_website">
	...decoy web content here...
	</div>
	<iframe id="target_website" src="https://vulnerable-website.com">
	</iframe>
</body>
```

## Burp Clickbandit
Although you can manually create a clickjacking proof of concept as described above, this can be fairly **tedious** and **time-consuming** in practice. When you're testing for clickjacking in the wild, we recommend using Burp's [Clickbandit](https://portswigger.net/burp/documentation/desktop/tools/clickbandit) tool instead. This lets you use your browser to perform the desired actions on the **frameable** page, then creates an **HTML** file containing a suitable clickjacking overlay. You can use this to generate an interactive **proof of concept** in a matter of seconds, without having to write a single line of HTML or CSS.

## Frame Busting Scripts
A common client-side protection is to use **frame busting** or **frame breaking** scripts. These can be implemented via proprietary browser JavaScript add-ons or extensions such as **NoScript**. These scripts often enforce the following:

-   Check and enforce that the current application window is the **main** or **top** window,
-   Make **all** frames **visible**,
-   **Prevent** clicking on invisible frames,
-   **Intercept** and **flag** potential clickjacking attacks to the user.

An effective attacker workaround against frame busters is to use the **HTML5 iframe** `sandbox` attribute. When this is set with the `allow-forms` or `allow-scripts` values and the `allow-top-navigation`  value is omitted then the frame buster script can be **neutralized** as the iframe cannot check whether or not it is the top window:

`<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms"></iframe>`

Both the `allow-forms` and `allow-scripts` values permit the specified actions within the iframe but top-level **navigation** is disabled. This inhibits frame busting behaviours while allowing functionality within the **targeted** site.

## Clickjacking with a DOM XSS Attack
Clickjacking can be used along side a [DOM-based cross-site scripting (XSS)](Cross-Site%20Scripting%20(XSS).md#DOM-Based) attack in order to get the victim to **execute** a [cross-site scripting (XSS)](Cross-Site%20Scripting%20(XSS).md) payload.

For example, if a submit feedback form is vulnerable to [cross-site scripting (XSS)](Cross-Site%20Scripting%20(XSS).md) then the user can be **clickjacked** into clicking the **submit** button whilst the [cross-site scripting (XSS)](Cross-Site%20Scripting%20(XSS).md) payload is **auto filled** into the form:
`feedback?name=<img src onerror="print()">&email=a@a.com&subject=a&message=a`

## Multistep Clickjacking
Sometimes **multiple** actions will be required in order to execute a clickjacking attack. For example, a shopping website may **require** a user to add an item to their **cart** before **checking out**.

[Burp Clickbandit](Clickjacking#Burp%20Clickbandit) can also be used to craft **multistep clickjacking** attacks.